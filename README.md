CS-Center, осень 2014, дополнительные главы алгоритмов  
Краюшкин Олег  
##Leftist Heap, Skew Heap. Both + bootstrapping  
  
###1. Постановка задачи  
* Реализовать алгоритм Leftist и Skew кучи. К обеим кучам добавить insert за O(1) и merge за O(1) (bootstrapping)
* Протестировать корректность реализации.  
* Сравнить в с `set<int>`, `priority_queue<int>`  

###2. Реализация  
В реализации обе кучи, по факту, отличаются двумя строчками кода.  
Тем не менее, в репозитории приведены все модификации.  
В директориях `leftist_heap` и `leftist_heap` находятся базовые реализации куч.  
  
####2.1. leftist_heap  
В **leftist_heap** реализован следующий основной интерфейс:  
`void build(InputIterator first, InputIterator last)` *O(n)*  
`void add(T val)`  *O(log(n))*  
`void mergeWithHeap(LHeap<T>& h)` *O(log(n))*  
`bool empty()` *O(1)*  
`T min(){` *O(1)*  
`void pop()` *O(log(n))*  
`void clear()` *O(n)*  
`void print()` *O(n)*  
`bool checkMin()` *O(n)*  
  
И несколько дополнительных внутренних методов:  
`int dRecount(LNode<T>* n)` *O(n)*  
`void clear(LNode<T> * n)` *O(n)*  
`LNode<T> * merge(LNode<T> * a, LNode<T> * b)` *O(log(n))*  
`void printSubtree(LNode<T>* n, int level)` *O(n)*  
`bool checkMin(LNode<T>* n)` *O(n)*  
  
####2.2. skew_heap  
В **skew_heap** реализован аналогичный интерфейс.  
Из встроенных методов здесь за ненадобностью отсутствует `int dRecount(LNode<T>* n)`.  
  
####2.3. leftist_heap_bootstrapped и skew_heap_bootstrapped  
В **leftist_heap_bootstrapped** и **skew_heap_bootstrapped** реализовано ускорение add. Здесь так же реализован аналогичный интерфейс, с той разницей, что `add(val)` выполняется здесь за *O(1)*, а оценка *O(k + log(n))* `pop()` теперь амортизировано учитывает *k* добавлений.  
  
####2.4 leftist_heap_merge_bootstrapped_int и skew_heap_merge_bootstrapped_int  
В **leftist_heap_merge_bootstrapped_int** и **skew_heap_merge_bootstrapped_int** реализованы надстройки над описанными выше кучами, улучшающие оценку на `merge(a,b)` до *O(1)*. Здесь отсутствуют `void print()` и `bool checkMin`, ввиду их изначальной необязательности, нехватки времени и нетривиальности их реализации для этой кучи.  
  
###3. Тестирование  
Тестирование для всех классов выполняется по одной схеме, включающей:  
* проверку на корректность построения кучи  
* замера времени полного построения и поочередного изъятия всех элементов  
* сравнение построения двух куч, объединения их в одну и поочередного изъятия элементов с аналогичными действиями на `set<int>` и `priority_queue<int>`.  
Чтобы воспроизвести тесты для конкретной реализации, запустите bash _run.sh в соответствующей директории.  
  
###4. Результаты тестирования  
Тест на WA 10000 раз строил и разбирал кучи размеров {3,5,10,20} на случайно сгенерированных данных, поверяя на корректность вновь извлеченный минимум.  
Тест на TL 10 раз строил и разбирал кучи из 1e5 случайно сгенерированных данных, замеряя время. 
Тест на сравнение (все остальные строки таблицы) 1 раз строил из 1e6 случайно сгенерированных данных две кучи, сливал их и разбирал получившуюся, замеряя время в наиболее интересных моментах:  
* время построение кучи  
* время слияние куч  
* время удаления первого элемента (важно для куч с bootstrapping'ом)  
* время удаления второго элемента  
* время извлечения всех 2e6 элементов  
Аналогичные действия на тех же данных производились на `set<int>` и `priority_queue<int>`.  
  
Нижеприведенные результаты тестирования подтверждают, что хотя сложность операций для левацкой, косой и бинарной куч идентичны, константы в этих оценках значительно портят картину.  
Тем не менее, свою специализацию они оправдывают, и слияние куч даже без применения bootstrapping'а выполняется действительно быстро.  

Event   \ Heap name:	|	lh		|	sh		|	lhb		|	shb		|	lhmbi	|	shmbi
------------------------|-----------|-----------|-----------|-----------|-----------|--------
Test 	WA:				|	OK.		|	OK.		|	OK.		|	OK.		|	OK.		|	OK.	
Test 	TL:				|	0.63	|	0.64	|	0.57	|	0.50	|	1.24	|	1.11
heap1   builded:		|	0.12	|	0.25	|	0.07	|	0.07	|	0.17	|	0.18
heap2   builded:		|	0.12	|	0.26	|	0.07	|	0.06	|	0.19	|	0.18
heaps   merged:			|	0.00	|	0.00	|	0.00	|	0.00	|	0.00	|	0.00
heap1   first access:	|	0.00	|	0.00	|	0.33	|	0.30	|	0.16	|	0.14
heap1   second access:	|	0.00	|	0.00	|	0.00	|	0.00	|	0.00	|	0.00
heap1   full extract:	|	1.86	|	1.70	|	2.23	|	1.87	|	2.44	|	1.99
prior_q builded:		|	0.03	|	0.02	|	0.03	|	0.02	|	0.03	|	0.02
prior_q builded:		|	0.02	|	0.02	|	0.02	|	0.02	|	0.03	|	0.03
prior_q merged:			|	0.21	|	0.24	|	0.24	|	0.22	|	0.25	|	0.26
prior_q full extract:	|	0.41	|	0.39	|	0.43	|	0.41	|	0.45	|	0.48
set1    builded:		|	0.70	|	0.70	|	0.73	|	0.71	|	0.94	|	1.11
set2    builded:		|	0.69	|	0.71	|	0.71	|	0.70	|	0.97	|	1.29
sets    merged:			|	0.45	|	0.45	|	0.46	|	0.44	|	0.45	|	0.48
set1    full extract:	|	0.31	|	0.31	|	0.30	|	0.32	|	0.34	|	0.34
  
lh		- leftist_heap  
sh		- skew_heap  
lhb		- leftist_heap_bootstrapped  
shb		- skew_heap_bootstrapped  
lhmbi	- leftist_heap_merge_bootstrapped_int  
shmbi	- skew_heap_merge_bootstrapped_int  
